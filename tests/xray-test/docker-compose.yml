version: '3.8'

# Xray Test Containers for V2Ray Ingress/Egress Testing
#
# xray-client: Connects to vpn-gateway's V2Ray ingress (port 443)
#              Provides SOCKS5 (1080) and HTTP (8080) proxy for testing
#
# xray-server: Provides VLESS server on port 10443 for egress testing
#              vpn-gateway can use this as a custom V2Ray egress

services:
  # Xray Client - Tests V2Ray Ingress
  # Connects to vpn-gateway:443 using VLESS + gRPC + REALITY
  xray-client:
    image: teddysun/xray:latest
    container_name: xray-client
    restart: unless-stopped
    volumes:
      - ./client-config.json:/etc/xray/config.json:ro
    ports:
      - "11080:1080"   # SOCKS5 proxy
      - "18080:8080"   # HTTP proxy
    network_mode: bridge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: ["xray", "run", "-c", "/etc/xray/config.json"]

  # Xray Server - For V2Ray Egress Testing
  # Provides VLESS server that vpn-gateway can connect to
  xray-server:
    image: teddysun/xray:latest
    container_name: xray-server
    restart: unless-stopped
    volumes:
      - ./server-config.json:/etc/xray/config.json:ro
    ports:
      - "10443:10443"  # VLESS server port
    network_mode: bridge
    command: ["xray", "run", "-c", "/etc/xray/config.json"]
