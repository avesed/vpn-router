services:
  vpn-gateway:
    container_name: vpn-gateway
    image: ghcr.io/avesed/vpn-router:latest
    privileged: true
    network_mode: host
    # sysctls 在 host 网络模式下不可用，需要在宿主机上设置：
    # sudo sysctl -w net.ipv4.ip_forward=1
    environment:
      - TZ=Asia/Shanghai
      - DISABLE_IPV6=1
      - PIA_USERNAME=${PIA_USERNAME:-}
      - PIA_PASSWORD=${PIA_PASSWORD:-}
      - WG_SERVER_ENDPOINT=${WG_SERVER_ENDPOINT:-}
      - WEB_PORT=${WEB_PORT:-36000}
      - WG_LISTEN_PORT=${WG_LISTEN_PORT:-36100}
    # network_mode: host - 不需要端口映射，直接使用宿主机端口
    # 访问 Web UI: http://localhost:${WEB_PORT:-36000}
    # WireGuard: ${WG_LISTEN_PORT:-36100}/udp
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - ./config:/etc/sing-box
    restart: unless-stopped
